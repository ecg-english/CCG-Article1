<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Grammar Hub | ä¸­å›½èªæ–‡æ³•ãƒ»å®Œå…¨æ”»ç•¥</title>
    <!-- Tailwind CSS (Utility) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        chinaRed: {
                            50: '#fff1f2',
                            100: '#ffe4e6',
                            200: '#fecdd3',
                            300: '#fda4af',
                            400: '#fb7185',
                            500: '#f43f5e',
                            600: '#e11d48', // Brand Base
                            700: '#be123c',
                            800: '#9f1239',
                            900: '#881337',
                        },
                        chinaGold: {
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-stone-50 min-h-screen pb-20">
    <div>
        <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <header class="hero-animate bg-chinaRed-900 text-white pt-12 pb-20 px-4 text-center rounded-b-[3rem] shadow-xl mb-12 relative overflow-hidden">
            <!-- èƒŒæ™¯è£…é£¾ï¼šé¾ã‚„é›²ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¢ã‚¤ã‚³ãƒ³ -->
            <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
                <i class="fa-solid fa-dragon hero-bg-icon text-9xl absolute top-[-20px] left-[-20px] opacity-10"></i>
                <i class="fa-solid fa-cloud hero-bg-icon text-9xl absolute bottom-[-10px] right-[-10px] opacity-10" style="animation-delay: -3s;"></i>
            </div>
            
            <div class="relative z-10">
                <h1 class="hero-title text-3xl md:text-5xl font-bold mb-4 tracking-tight font-serif-sc">
                    ä¸­å›½æ–‡æ³• å®Œå…¨æ”»ç•¥æ•™æ
                </h1>
                <p class="hero-subtitle text-red-100/80 max-w-xl mx-auto tracking-tight font-serif-sc">
                    ã‚¼ãƒ­ã‹ã‚‰ãƒã‚¤ãƒ†ã‚£ãƒ–æ€è€ƒã¸å°ãã€æœ€å¼·ã®ä¸­å›½èªæ–‡æ³•ã‚¬ã‚¤ãƒ‰ã€‚
                </p>
            </div>
        </header>

        <!-- ãƒ¬ãƒ™ãƒ«é¸æŠã‚°ãƒªãƒƒãƒ‰ -->
        <div class="px-4 max-w-5xl mx-auto -mt-16 grid gap-6 md:grid-cols-2 mb-12 relative z-10">
            
            <!-- Level 0: è¶…å…¥é–€ -->
            <a href="level0/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-100" data-delay="0" data-level="0">
                <div class="h-2 bg-gradient-to-r from-teal-400 to-teal-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-14 h-14 rounded-xl bg-teal-600 text-white flex items-center justify-center shadow-md shadow-teal-200 overflow-hidden">
                            <img src="image/level0Icon.png" alt="Level 0 Icon" class="w-full h-full object-contain p-1">
                        </div>
                        <div class="progress-chart" data-level="0">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-0" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#2dd4bf;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e7e5e4" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-0)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-stone-800 mb-1 tracking-tight font-serif-sc">Level 0: è¶…å…¥é–€</h2>
                    <p class="text-xs font-bold text-teal-600 uppercase tracking-wider mb-3">THE CORE</p>
                    <p class="text-sm text-stone-500 mb-6 min-h-[3em] leading-6">
                        ä¸­å›½èªã®ã€ŒOSã€ã‚’å…¥ã‚Œã‚‹ã€‚<br>
                        ç™ºéŸ³ãƒ»å››å£°ãƒ»åŸºæœ¬èªé †(SVO)ãƒ»æ˜¯/æœ‰/åœ¨ã®å¾¹åº•ç†è§£ã€‚
                    </p>
                    <div class="flex items-center text-sm font-bold text-teal-600 group tracking-tight font-serif-sc">
                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>

            <!-- Level 1: åˆç´š -->
            <a href="level1/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-100" data-delay="100" data-level="1">
                <div class="h-2 bg-gradient-to-r from-sky-400 to-sky-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-14 h-14 rounded-xl bg-sky-600 text-white flex items-center justify-center shadow-md shadow-sky-200 overflow-hidden">
                            <img src="image/level1Icon.png" alt="Level 1 Icon" class="w-full h-full object-contain p-1">
                        </div>
                        <div class="progress-chart" data-level="1">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#38bdf8;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#0284c7;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e7e5e4" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-1)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-stone-800 mb-1 tracking-tight font-serif-sc">Level 1: åˆç´š</h2>
                    <p class="text-xs font-bold text-sky-600 uppercase tracking-wider mb-3">EXPANDING THE WORLD</p>
                    <p class="text-sm text-stone-500 mb-6 min-h-[3em] leading-6">
                        æ™‚ç©ºã¨çŠ¶æ…‹ã‚’æå†™ã™ã‚‹ã€‚<br>
                        å®Œäº†ã®ã€Œäº†ã€ã€é€²è¡Œå½¢ã€èƒ½é¡˜å‹•è©ã§æ—¥å¸¸ä¼šè©±ã‚’æˆç«‹ã•ã›ã‚‹ã€‚
                    </p>
                    <div class="flex items-center text-sm font-bold text-sky-600 group tracking-tight font-serif-sc">
                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>

            <!-- Level 2: ä¸­ç´š -->
            <a href="level2/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-100" data-delay="200" data-level="2">
                <div class="h-2 bg-gradient-to-r from-amber-400 to-amber-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-14 h-14 rounded-xl bg-amber-500 text-white flex items-center justify-center shadow-md shadow-amber-200 overflow-hidden">
                            <img src="image/level2Icon.png" alt="Level 2 Icon" class="w-full h-full object-contain p-1">
                        </div>
                        <div class="progress-chart" data-level="2">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e7e5e4" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-2)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-stone-800 mb-1 tracking-tight font-serif-sc">Level 2: ä¸­ç´š</h2>
                    <p class="text-xs font-bold text-amber-600 uppercase tracking-wider mb-3">NUANCE & COMPLEMENTS</p>
                    <p class="text-sm text-stone-500 mb-6 min-h-[3em] leading-6">
                        ã“ã“ãŒæœ€å¤§ã®å±±å ´ã€‚<br>
                        å„ç¨®ã€Œè£œèªã€ã€æŠŠæ§‹æ–‡ã€å—èº«ãªã©ã€ä¸­å›½èªç‰¹æœ‰ã®æ¦‚å¿µã‚’å®Œå…¨æ”»ç•¥ã€‚
                    </p>
                    <div class="flex items-center text-sm font-bold text-amber-600 group tracking-tight font-serif-sc">
                            å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>

            <!-- Level 3: ä¸Šç´š -->
            <a href="level3/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-100" data-delay="300" data-level="3">
                <div class="h-2 bg-gradient-to-r from-chinaRed-400 to-chinaRed-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-14 h-14 rounded-xl bg-chinaRed-600 text-white flex items-center justify-center shadow-md shadow-red-200 overflow-hidden">
                            <img src="image/level3Icon.png" alt="Level 3 Icon" class="w-full h-full object-contain p-1">
                        </div>
                        <div class="progress-chart" data-level="3">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-3" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#fb7185;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#e11d48;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e7e5e4" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-3)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-stone-800 mb-1 tracking-tight font-serif-sc">Level 3: ä¸Šç´š</h2>
                    <p class="text-xs font-bold text-chinaRed-600 uppercase tracking-wider mb-3">LOGIC & NATIVE MIND</p>
                    <p class="text-sm text-stone-500 mb-6 min-h-[3em] leading-6">
                        è«–ç†ã¨ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã®çµ±åˆã€‚<br>
                        è¤‡æ–‡ã€èªæ°—åŠ©è©ã€ç‰¹æ®Šæ§‹æ–‡ã‚’ä½¿ã„ã“ãªã—ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã®æ„Ÿè¦šã¨åŒåŒ–ã™ã‚‹ã€‚
                    </p>
                    <div class="flex items-center text-sm font-bold text-chinaRed-600 group tracking-tight font-serif-sc">
                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>
        </div>
        
        <footer class="footer-animate text-center text-stone-400 text-sm pb-10">
            &copy; 2025 Chinese Grammar Hub
        </footer>
    </div>

    <!-- CCG chanãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
    <button id="ecgKunButton" class="ecg-kun-button fixed bottom-6 right-6 z-50 w-16 h-16 rounded-full bg-white shadow-xl hover:shadow-2xl transition-all duration-300 flex items-center justify-center border-4 border-chinaRed-100 hover:border-chinaRed-400 group overflow-hidden">
        <img id="ecgKunFloatingImg" src="image/CCG-chan.png" alt="CCG chan" class="w-12 h-12 object-contain">
    </button>

    <!-- CCG chanãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="ecgChatModal" class="ecg-chat-modal fixed inset-0 z-[100] flex items-center justify-center pointer-events-none">
        <div class="ecg-chat-overlay absolute inset-0 bg-stone-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
        <div class="ecg-chat-container relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[80vh] max-h-[800px] flex flex-col transform scale-95 opacity-0 transition-all duration-300 border border-stone-100">
            <!-- ãƒãƒ£ãƒƒãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="ecg-chat-header bg-gradient-to-r from-chinaRed-600 to-chinaRed-700 text-white p-4 rounded-t-2xl flex items-center justify-between shadow-md">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center overflow-hidden">
                        <img src="image/CCG-chan.png" alt="CCG chan" class="w-full h-full object-contain">
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">CCG chan</h3>
                        <p class="text-xs text-red-100">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ»24æ™‚é–“å¯¾å¿œ</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="ecgChatClose" class="w-8 h-8 rounded-full hover:bg-white/10 flex items-center justify-center transition-colors">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
            <div id="ecgChatMessages" class="ecg-chat-messages flex-1 overflow-y-auto p-4 space-y-4 bg-stone-50">
                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
            </div>

            <!-- ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆé¸æŠè‚¢ãƒœã‚¿ãƒ³ç”¨ï¼‰ -->
            <div id="ecgChatOptions" class="ecg-chat-options p-4 border-t border-stone-200 space-y-2 bg-white rounded-b-2xl">
                <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
            </div>
        </div>
    </div>

    <script>
        // ä¸­å›½èªã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”¨ã®æ§‹æˆè¨­å®š
        // Lesson IDã¯ l{level}-{number} å½¢å¼ã€‚ç·æ•°ã¯å‰ã®è­°è«–ã«åŸºã¥ãè¨­å®šã€‚
        const levelConfig = {
            0: { total: 8, lessons: ['l0-1', 'l0-2', 'l0-3', 'l0-4', 'l0-5', 'l0-6', 'l0-7', 'l0-8'], name: 'è¶…å…¥é–€' },
            1: { total: 9, lessons: ['l1-1', 'l1-2', 'l1-3', 'l1-4', 'l1-5', 'l1-6', 'l1-7', 'l1-8', 'l1-9'], name: 'åˆç´š' },
            2: { total: 9, lessons: ['l2-1', 'l2-2', 'l2-3', 'l2-4', 'l2-5', 'l2-6', 'l2-7', 'l2-8', 'l2-9'], name: 'ä¸­ç´š' },
            3: { total: 9, lessons: ['l3-1', 'l3-2', 'l3-3', 'l3-4', 'l3-5', 'l3-6', 'l3-7', 'l3-8', 'l3-9'], name: 'ä¸Šç´š' }
        };

        // é”æˆç‡ã‚’è¨ˆç®—ã—ã¦å††ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
        function updateProgressChart(level, delay = 0) {
            const config = levelConfig[level];
            if (!config) return;

            let completedCount = 0;
            config.lessons.forEach(lessonId => {
                const key = `lesson_completed_${lessonId}`;
                if (localStorage.getItem(key) === 'true') {
                    completedCount++;
                }
            });

            const percentage = Math.round((completedCount / config.total) * 100);
            const chart = document.querySelector(`.progress-chart[data-level="${level}"]`);
            if (!chart) return;

            const circle = chart.querySelector('.progress-ring-circle');
            const text = chart.querySelector('.progress-text');
            
            if (circle && text) {
                const circumference = 2 * Math.PI * 20; // r=20
                const offset = circumference - (percentage / 100) * circumference;
                
                // åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = circumference; 
                
                setTimeout(() => {
                    circle.style.strokeDashoffset = offset;
                    animateCounter(text, 0, percentage, 800);
                }, delay);
            }
        }

        // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function animateCounter(element, start, end, duration) {
            const startTime = performance.now();
            const animate = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = Math.round(start + (end - start) * easeOut);
                
                element.textContent = `${current}%`;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    element.textContent = `${end}%`;
                }
            };
            requestAnimationFrame(animate);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            const cards = document.querySelectorAll('.card-animate');
            cards.forEach((card) => {
                const delay = parseInt(card.getAttribute('data-delay')) || 0;
                const level = parseInt(card.getAttribute('data-level')) || 0;
                const cardDelay = 300 + delay * 0.5;
                
                setTimeout(() => {
                    card.classList.add('visible');
                    // ãƒãƒ£ãƒ¼ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    updateProgressChart(level, cardDelay + 600);
                }, cardDelay);
            });

            // ãƒ•ãƒƒã‚¿ãƒ¼
            const footer = document.querySelector('.footer-animate');
            setTimeout(() => {
                footer.classList.add('visible');
            }, 600);

            // ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½åˆæœŸåŒ–
            initPandaChat();
        });

        // CCG chanãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
        function initPandaChat() {
            const chatButton = document.getElementById('ecgKunButton');
            const chatModal = document.getElementById('ecgChatModal');
            const chatClose = document.getElementById('ecgChatClose');
            const chatMessages = document.getElementById('ecgChatMessages');
            const chatOptions = document.getElementById('ecgChatOptions');

            const qaData = [
                {
                    question: 'å­¦ç¿’é€²æ—ã¯ã©ã†ã§ã™ã‹ï¼Ÿ',
                    type: 'progress',
                    answer: null 
                },
                {
                    question: 'æ¬¡ã¯ä½•ã‚’ã™ã‚Œã°ã„ã„ï¼Ÿ',
                    type: 'recommendation',
                    answer: null
                },
                {
                    question: 'ä¸­å›½èªã®ç™ºéŸ³ãŒé›£ã—ã„...',
                    answer: 'ç™ºéŸ³ã¯ä¸­å›½èªã®å‘½ã§ã™ã­ï¼ç‰¹ã«ã€Œå››å£°ï¼ˆå£°èª¿ï¼‰ã€ã¯ä½•åº¦ã‚‚èã„ã¦çœŸä¼¼ã‚‹ã®ãŒä¸€ç•ªã§ã™ã€‚Level 0ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§éŸ³æºã‚’ä½•åº¦ã‚‚å†ç”Ÿã—ã€è‡ªåˆ†ã®å£°ã‚’éŒ²éŸ³ã—ã¦æ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æœ€åˆã¯ã‚ªãƒ¼ãƒãƒ¼ãªãã‚‰ã„å¤§ã’ã•ã«ç™ºéŸ³ã™ã‚‹ã®ãŒã‚³ãƒ„ã§ã™ã‚ˆï¼'
                },
                {
                    question: 'ã€Œè£œèªã€ã£ã¦ä½•ï¼Ÿ',
                    answer: 'è£œèªã¯ä¸­å›½èªã®ã€Œã‚¹ãƒ‘ã‚¤ã‚¹ã€ã§ã™ã€‚ã€Œé£Ÿã¹ãŸï¼ˆåƒï¼‰ã€ã ã‘ã§ãªãã€ã€Œé£Ÿã¹çµ‚ã‚ã£ãŸï¼ˆåƒå®Œï¼‰ã€ã€ŒãŠè…¹ã„ã£ã±ã„é£Ÿã¹ãŸï¼ˆåƒé¥±ï¼‰ã€ã®ã‚ˆã†ã«ã€å‹•ä½œã®çµæœã‚„çŠ¶æ…‹ã‚’è©³ã—ãèª¬æ˜ã™ã‚‹å½¹å‰²ãŒã‚ã‚Šã¾ã™ã€‚Level 2ã§ãŸã£ã·ã‚Šç·´ç¿’ã™ã‚‹ã®ã§ãŠæ¥½ã—ã¿ã«ï¼'
                },
                {
                    question: 'ã“ã®ã‚µã‚¤ãƒˆã®ä½¿ã„æ–¹ã¯ï¼Ÿ',
                    answer: '4ã¤ã®ãƒ¬ãƒ™ãƒ«ã‚’é †ç•ªã«é€²ã‚ã‚‹ã®ãŒç‹é“ã§ã™ãŒã€æ°—ã«ãªã‚‹ãƒˆãƒ”ãƒƒã‚¯ã‹ã‚‰ã¤ã¾ã¿é£Ÿã„ã—ã¦ã‚‚OKã§ã™ã€‚å„ãƒ¬ãƒƒã‚¹ãƒ³ã«ã¯ã€Œç¢ºèªãƒ†ã‚¹ãƒˆã€ãŒã¤ã„ã¦ã„ã‚‹ã®ã§ã€å…¨å•æ­£è§£ã—ã¦ã‚¯ãƒªã‚¢ãƒãƒ¼ã‚¯ã‚’é›†ã‚ã¦ã„ã£ã¦ãã ã•ã„ã­ï¼'
                }
            ];

            let isInitialized = false;

            function openChat() {
                chatModal.classList.add('active');
                if (!isInitialized) {
                    showInitialMessage();
                    isInitialized = true;
                }
            }

            function closeChat() {
                chatModal.classList.remove('active');
            }

            function showInitialMessage() {
                chatMessages.innerHTML = '';
                
                const initialMessage = `
                    <div class="ecg-message ecg-message-bot">
                        <div class="ecg-message-avatar flex items-center justify-center bg-white w-10 h-10 rounded-full overflow-hidden">
                            <img src="image/CCG-chan.png" alt="CCG chan" class="w-full h-full object-contain">
                        </div>
                        <div class="ecg-message-content shadow-sm">
                            <p>ä½ å¥½ (NÇ hÇo)ï¼CCG chanã§ã™ï¼</p>
                            <p class="mt-2">ã€Œä¸­å›½æ–‡æ³• å®Œå…¨æ”»ç•¥æ•™æã€ã¸ã‚ˆã†ã“ãï¼æ¬¢è¿ (HuÄnyÃ­ng)ï¼</p>
                            <p class="mt-2">ã“ã“ã¯ã€ä¸­å›½èªã®æ–‡æ³•ã‚’ã€Œæš—è¨˜ã€ã§ã¯ãªãã€Œç†å±ˆã€ã§ç†è§£ã™ã‚‹ãŸã‚ã®å ´æ‰€ã§ã™ã€‚</p>
                            <p class="mt-2">å›°ã£ãŸã“ã¨ã‚„è³ªå•ãŒã‚ã‚Œã°ã€ä¸‹ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ã­ã€‚åŠ æ²¹ (JiÄyÃ³u)ï¼</p>
                        </div>
                    </div>
                `;
                chatMessages.innerHTML = initialMessage;
                showQAOptions();
            }

            function showQAOptions() {
                chatOptions.innerHTML = '';
                qaData.forEach((qa) => {
                    const button = document.createElement('button');
                    button.className = 'ecg-option-button hover:shadow-md';
                    button.textContent = qa.question;
                    button.addEventListener('click', () => {
                        showAnswer(qa.question, qa.answer, qa.type);
                        chatOptions.innerHTML = '';
                    });
                    chatOptions.appendChild(button);
                });
            }

            function showAnswer(question, answer, type) {
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const userMessage = document.createElement('div');
                userMessage.className = 'ecg-message ecg-message-user';
                userMessage.innerHTML = `
                    <div class="ecg-message-content shadow-sm bg-chinaRed-600 text-white">
                        <p>${question}</p>
                    </div>
                `;
                chatMessages.appendChild(userMessage);
                scrollToBottom();

                // Botå›ç­”
                setTimeout(() => {
                    const botMessage = document.createElement('div');
                    botMessage.className = 'ecg-message ecg-message-bot';
                    
                    let answerText = '';
                    
                    if (type === 'progress') {
                        // é€²æ—è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                        let total = 0, completed = 0;
                        Object.values(levelConfig).forEach(l => {
                            total += l.total;
                            l.lessons.forEach(id => {
                                if(localStorage.getItem(`lesson_completed_${id}`) === 'true') completed++;
                            });
                        });
                        const pct = Math.round((completed/total)*100);
                        
                        answerText = `
                            <p><strong>ç¾åœ¨ã®é€²æ—çŠ¶æ³ï¼š</strong></p>
                            <p class="mt-2">å…¨ãƒ¬ãƒƒã‚¹ãƒ³ã® <strong>${pct}%</strong> (${completed}/${total}) ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼</p>
                            <p class="mt-2 text-sm text-stone-500">ç¶™ç¶šã¯åŠ›ãªã‚Šã€‚æ¯æ—¥å°‘ã—ãšã¤é€²ã‚ã¾ã—ã‚‡ã†ï¼</p>
                        `;
                    } else if (type === 'recommendation') {
                        // å„ãƒ¬ãƒ™ãƒ«ã®å®Œäº†çŠ¶æ³ã‚’ç¢ºèª
                        let recommendedLevel = null;
                        let recommendedName = '';
                        let recommendedMessage = '';
                        
                        for (let level = 0; level <= 3; level++) {
                            const config = levelConfig[level];
                            if (!config) continue;
                            
                            let completedCount = 0;
                            config.lessons.forEach(lessonId => {
                                if (localStorage.getItem(`lesson_completed_${lessonId}`) === 'true') {
                                    completedCount++;
                                }
                            });
                            
                            // æœªå®Œäº†ã®ãƒ¬ãƒ™ãƒ«ã‚’è¦‹ã¤ã‘ãŸã‚‰æ¨å¥¨
                            if (completedCount < config.total) {
                                recommendedLevel = level;
                                recommendedName = config.name;
                                
                                // å®Œäº†ç‡ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                                const completionRate = Math.round((completedCount / config.total) * 100);
                                
                                if (level === 0) {
                                    recommendedMessage = 'åŸºç¤ã®ç™ºéŸ³ã¨SVOèªé †ãŒã™ã¹ã¦ã®åœŸå°ã«ãªã‚Šã¾ã™ã€‚';
                                } else if (level === 1) {
                                    recommendedMessage = 'æ™‚åˆ¶ã‚„çŠ¶æ…‹è¡¨ç¾ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¦ã€æ—¥å¸¸ä¼šè©±ã‚’æˆç«‹ã•ã›ã¾ã—ã‚‡ã†ã€‚';
                                } else if (level === 2) {
                                    recommendedMessage = 'ä¸­å›½èªç‰¹æœ‰ã®ã€Œè£œèªã€ã¨ã€Œæ§‹æ–‡ã€ã‚’åˆ¶ã—ã€è¤‡é›‘ãªæå†™ã‚’å¯èƒ½ã«ã—ã¾ã—ã‚‡ã†ã€‚';
                                } else if (level === 3) {
                                    recommendedMessage = 'æ¥ç¶šè©ã€èªæ°—åŠ©è©ã€ç‰¹æ®Šæ§‹æ–‡ã‚’ä½¿ã„ã“ãªã—ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã®æ„Ÿè¦šã¨åŒåŒ–ã—ã¾ã—ã‚‡ã†ã€‚';
                                }
                                
                                if (completionRate > 0) {
                                    recommendedMessage = `${completionRate}% å®Œäº†ã—ã¦ã„ã¾ã™ã€‚æ®‹ã‚Šã‚’é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼`;
                                }
                                break;
                            }
                        }
                        
                        // å…¨ã¦å®Œäº†ã—ã¦ã„ã‚‹å ´åˆ
                        if (recommendedLevel === null) {
                            answerText = `
                                <p>ç´ æ™´ã‚‰ã—ã„ï¼å…¨ã¦ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼ğŸ‰</p>
                                <p class="mt-2">å¾©ç¿’ã‚’é‡ã­ã¦ã€ä¸­å›½èªã‚’è‡ªåˆ†ã®ã‚‚ã®ã«ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>
                            `;
                        } else {
                            answerText = `
                                <p>ã¾ãšã¯ <strong>Level ${recommendedLevel}: ${recommendedName}</strong> ã®å®Œäº†ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼</p>
                                <p class="mt-2">${recommendedMessage}</p>
                            `;
                        }
                    } else {
                        answerText = `<p>${answer}</p>`;
                    }
                    
                    botMessage.innerHTML = `
                        <div class="ecg-message-avatar flex items-center justify-center bg-white w-10 h-10 rounded-full overflow-hidden">
                            <img src="image/CCG-chan.png" alt="CCG chan" class="w-full h-full object-contain">
                        </div>
                        <div class="ecg-message-content shadow-sm">
                            ${answerText}
                        </div>
                    `;
                    chatMessages.appendChild(botMessage);
                    scrollToBottom();

                    setTimeout(showQAOptions, 600);
                }, 400);
            }

            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            chatButton.addEventListener('click', openChat);
            chatClose.addEventListener('click', closeChat);
            chatModal.querySelector('.ecg-chat-overlay').addEventListener('click', closeChat);
        }
    </script>
</body>
</html>